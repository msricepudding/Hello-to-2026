<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>2025-2026 跨年夜</title>
    <style>
        body { margin: 0; background: #000005; overflow: hidden; font-family: 'Courier New', Courier, monospace; }
        #overlay {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; color: #f5d5d0; z-index: 10; width: 85%;
        }
        #typewriter-text {
            font-size: 26px; min-height: 1.5em; letter-spacing: 2px;
            line-height: 1.6; text-shadow: 0 0 15px #E0A39A; font-weight: bold;
        }
        button {
            padding: 15px 40px; font-size: 18px; cursor: pointer; margin-top: 30px;
            background: rgba(224, 163, 154, 0.1); border: 2px solid #ffb6c1; color: #ffb6c1;
            border-radius: 30px; transition: all 0.3s; backdrop-filter: blur(5px);
        }
        button:hover { background: #E0A39A; color: #000; box-shadow: 0 0 30px #E0A39A; }
        #loading-bar { position: fixed; top: 0; left: 0; height: 4px; background: #ffb6c1; width: 0%; z-index: 1000; }
        #status { position: absolute; bottom: 20px; left: 20px; color: rgba(255, 182, 193, 0.4); font-size: 12px; }
    </style>
</head>
<body>
    <div id="loading-bar"></div>
    <div id="overlay">
        <div id="typewriter-text"></div>
        <button id="startBtn">开始进入 2026</button>
    </div>
    <div id="status">系统就绪</div>

    <video id="video" style="display:none;" autoplay playsinline></video>
    <canvas id="main-canvas"></canvas>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

    <script>
        let scene, camera, renderer, coreLight, heartGroup, stars;
        let photos = [];
        let isExploded = false;
        let mouseX = 0, mouseY = 0;
        const photoCount = 21; // 0-20

        // --- 1. 打字机逻辑 (纯文字动效) ---
        const textToType = "Kiss a goodbye to 2025 and may we all have a magnificent 2026";
        function runTypewriter() {
            const container = document.getElementById('typewriter-text');
            let i = 0;
            
            function type() {
                if (i < textToType.length) {
                    container.innerHTML += textToType.charAt(i);
                    i++;
                    setTimeout(type, 5000 / textToType.length); // 5秒内均匀打完
                } else {
                    // 打完后停顿1秒进入3D
                    setTimeout(() => {
                        document.getElementById('overlay').style.opacity = 0;
                        document.getElementById('overlay').style.transition = "opacity 1s";
                        setTimeout(() => {
                            document.getElementById('overlay').style.display = 'none';
                            initThreeScene();
                            startMediaPipe();
                        }, 1000);
                    }, 1000);
                }
            }
            type();
        }

        // --- 2. 3D 场景初始化 ---
        function initThreeScene() {
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x000008, 0.012);
            
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position
